<html>
  <head>
    <meta charset="utf-8" />
    <title>Generation de QR-codes pour cartes</title>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script type="text/javascript" src="html2pdf.js"></script>
    <script type="text/javascript" src="jspdf.min.js"></script>
  </head>
  <body>
    <table>
      <tr><th>Uploader CSV de noms</th><th>Generer un pdf</th></tr>
      <tr>
        <td><input type="file" id="input" onchange="handleFiles(this.files)"></td>
        <td><button onclick="generate_pdf()">Generer le PDF</button></td>
      </tr>
    </table>
    <br/>
    <table id="input_names" border="1px" cellpadding="10px"></table>

    <script type="text/javascript">

    function printCSV(text) {
      innerHTML = ""
      lines = text.split('\n')
      for (var i = 0; i < lines.length; i++) {
        line = lines[i]
        if (line != "") {
          innerHTML += "<tr><td>" + line + "</td><td><div id=\"qrcode " + line + "\"></div></td></tr>"
        }
      }
      document.getElementById("input_names").innerHTML = innerHTML
      for (var i = 0; i < lines.length; i++) {
        line = lines[i]
        if (line != "") {
          var qrcode = new QRCode(document.getElementById("qrcode " + line), {
            width : 100,
            height : 100
          });
          qrcode.makeCode(line)
        }
      }
    }

    function handleFiles(files) {
      console.log(files[0])
      var reader = new FileReader();
      var res = null
      reader.onload = function(e) {
        printCSV(reader.result)
      }
      reader.readAsText(files[0])
    }

    function generate_pdf() {
      var pdf = new jsPDF('p', 'pt', 'a4');
      pdf.canvas.height = 72 * 11;
      pdf.canvas.width = 72 * 8.5;
      html2pdf(document.getElementById("input_names").outerHTML, pdf, function(pdf){
        var iframe = document.createElement('iframe');
        iframe.setAttribute('style','position:absolute;right:0; top:0; bottom:0; height:100%; width:500px');
        document.body.appendChild(iframe);
        iframe.src = pdf.output('datauristring');
      });
      doc.save('a4.pdf')
    }
    </script>
  </body>
</html>
